#!/usr/bin/env bash
source ${HOME}/.bashrc
################################################################################

declare SETCONF_DIR="/.g/_data/zactive/.setup"

declare LIBVIRT_DIR="/.g/_data/_systems/libvirt"

################################################################################

${RM}					/etc/localtime
${LN} /usr/share/zoneinfo/US/Pacific	/etc/localtime
${RM}					/run/udev
${LN} /dev/.udev			/run/udev

########################################

declare DIR=
for DIR in \
	apache		\
	awstats		\
	bind		\
	cups		\
	dhcpd		\
	dovecot		\
	etc		\
	gentoo		\
	grub		\
	hostapd		\
	libvirt		\
	linux		\
	minicom		\
	nginx		\
	ntp		\
	openvpn		\
	proftpd		\
	samba		\
	ssh		\
	udev		\
	ulogd		\
	vmware		\
	xorg
do
	${MKDIR}			/.setup/${DIR}
	setconf ${SETCONF_DIR}/${DIR}	/.setup/${DIR}
done

########################################

chown -vR root:root			/.setup
chmod -vR 755				/.setup

${RM}					/.setup/.setconf
${LN} ${SETCONF_DIR}/.setconf		/.setup/.setconf

########################################

# apache
${RM}					/etc/apache2
${LN} /.setup/apache			/etc/apache2

# awstats
${RM}					/etc/awstats
${LN} /.setup/awstats			/etc/awstats

# bind
chown -vR nobody:root			/.setup/bind
${RM}					/etc/bind
${LN} /.setup/bind			/etc/bind
${RM}					/etc/named.conf
${LN} /.setup/bind/named.conf		/etc/named.conf

# cups
${RM}					/.setup/cups/mime.*
${LN} /usr/share/cups/mime/mime.*	/.setup/cups
${RM}					/etc/cups
${LN} /.setup/cups			/etc/cups

# dhcpd
${RM}					/etc/dhcp/dhcpd.conf
${LN} /.setup/dhcpd/dhcpd.conf		/etc/dhcp/dhcpd.conf
${RM}					/etc/dhcpd.conf
${LN} /.setup/dhcpd/dhcpd.conf		/etc/dhcpd.conf

# dovecot
${RM}					/etc/dovecot
${LN} /.setup/dovecot			/etc/dovecot

# etc
${RM}					/etc/resolv.conf.*
declare FILE=
for FILE in \
	crypttab	\
	exports		\
	fstab		\
	host.conf	\
	hostname	\
	hosts		\
	issue		\
	locale.gen	\
	modules		\
	motd		\
	networks	\
	resolv.conf	\
	sysctl.conf
do
	${RM}				/etc/${FILE}
	${LN} /.setup/etc/${FILE}	/etc/${FILE}
done

# gentoo
${RM}					/etc/portage/make.conf
${LN} /.setup/gentoo/make.conf		/etc/portage/make.conf
${RM}					/etc/portage/package.keywords
${LN} /.setup/gentoo/package.keywords	/etc/portage/package.keywords
${RM}					/etc/portage/package.license
${LN} /.setup/gentoo/package.license	/etc/portage/package.license
${RM}					/etc/portage/package.mask
${LN} /.setup/gentoo/package.mask	/etc/portage/package.mask
${RM}					/etc/portage/package.unmask
${LN} /.setup/gentoo/package.unmask	/etc/portage/package.unmask
${RM}					/etc/portage/package.use
${LN} /.setup/gentoo/package.use	/etc/portage/package.use
${RM}					/etc/portage/savedconfig
${LN} /.setup/gentoo/savedconfig	/etc/portage/savedconfig
${RM}					/etc/portage/sets
${LN} /.setup/gentoo/sets		/etc/portage/sets

# grub
${RM}					/boot/grub/grub.cfg
${LN} /.setup/grub/grub.cfg		/boot/grub/grub.cfg

# hostapd
${RM}					/etc/hostapd/hostapd.conf
${LN} /.setup/hostapd/hostapd.conf	/etc/hostapd/hostapd.conf

# libvirt
${RM}					/etc/libvirt/libvirt.conf
${LN} /.setup/libvirt/libvirt.conf	/etc/libvirt/libvirt.conf
${RM}					/etc/libvirt/libvirtd.conf
${LN} /.setup/libvirt/libvirtd.conf	/etc/libvirt/libvirtd.conf
${RM}					/etc/libvirt/qemu
${LN} ${LIBVIRT_DIR}/qemu		/etc/libvirt/qemu
${RM}					/etc/libvirt/storage
${LN} ${LIBVIRT_DIR}/storage		/etc/libvirt/storage
${RM}					/var/lib/libvirt/qemu
${LN} ${LIBVIRT_DIR}/qemu.lib		/var/lib/libvirt/qemu

# linux

# minicom
${RM}					/etc/minicom
${LN} /.setup/minicom			/etc/minicom
${RM}					/etc/minirc.dfl
${LN} /.setup/minicom/minirc.dfl	/etc/minirc.dfl

# nginx
${RM}					/etc/nginx
${LN} /.setup/nginx			/etc/nginx

# ntp
${RM}					/etc/ntp-servers.conf
${LN} /.setup/ntp/ntp-servers.conf	/etc/ntp-servers.conf
${RM}					/etc/ntp.conf
${LN} /.setup/ntp/ntp.conf		/etc/ntp.conf

# openvpn
${RM}					/etc/openvpn
${LN} /.setup/openvpn			/etc/openvpn

# proftpd
${RM}					/etc/proftpd/proftpd.conf
${LN} /.setup/proftpd/proftpd.conf	/etc/proftpd/proftpd.conf

# samba
${MKDIR}				/.setup/samba/private/msg.sock
chmod -v 700				/.setup/samba/private{,/msg.sock}
chmod -v 600				/.setup/samba/private/*.tdb
${RM}					/etc/samba
${LN} /.setup/samba			/etc/samba
${RM}					/var/lib/samba/private
${LN} /.setup/samba/private		/var/lib/samba/private
echo "create /var/lib/samba/winbindd_idmap.tdb" | tdbtool

# ssh
chmod -v 400				/.setup/ssh/ssh_host_*
${RM}					/etc/ssh
${LN} /.setup/ssh			/etc/ssh

# udev
${RM}					/etc/udev/rules.d
${LN} /.setup/udev/rules.d		/etc/udev/rules.d

# ulogd
${RM}					/etc/ulogd.conf
${LN} /.setup/ulogd/ulogd.conf		/etc/ulogd.conf

# vmware
chown -vR plastic:root			/.setup/vmware
${RM}					/etc/vmware
${LN} /.setup/vmware			/etc/vmware
${RM}					/etc/vmware-tools
${LN} /.setup/vmware/etc		/etc/vmware-tools
${RM}					/opt/vmware-tools
${LN} /.setup/vmware/opt		/opt/vmware-tools

# xorg
${RM}					/etc/X11/Xmodmap
${LN} /.setup/xorg/Xmodmap		/etc/X11/Xmodmap
${RM}					/etc/X11/xorg.conf
#>>>${LN} /.setup/xorg/xorg.conf		/etc/X11/xorg.conf

########################################

${MKDIR}				/.runit
setconf ${SETCONF_DIR}/runit		/.runit

if [[ ${1} == -r ]]; then
	(cd /.runit;			./_build.sh)
fi

exit 0
################################################################################
# end of file
################################################################################
