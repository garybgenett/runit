#!/usr/bin/env bash
source ${HOME}/.bashrc
################################################################################

declare SETCONF_DIR="/.g/_data/zactive/.setup"

################################################################################

${RM}					/etc/localtime
${LN} /usr/share/zoneinfo/US/Pacific	/etc/localtime

########################################

declare DIR=
for DIR in \
	bind		\
	cups		\
	dhcpd		\
	dovecot		\
	etc		\
	gentoo		\
	grub		\
	linux		\
	minicom		\
	ntp		\
	openvpn		\
	proftpd		\
	samba		\
	ssh		\
	xorg
do
	${MKDIR}			/.setup/${DIR}
	setconf ${SETCONF_DIR}/${DIR}	/.setup/${DIR}
done

########################################

chown -vR root:root			/.setup
chmod -vR 755				/.setup

${RM}					/.setup/.setconf
${LN} ${SETCONF_DIR}/.setconf		/.setup/.setconf

########################################

# bind
chown -vR nobody:root			/.setup/bind
${RM}					/etc/bind
${LN} /.setup/bind			/etc/bind
${RM}					/etc/named.conf
${LN} /.setup/bind/named.conf		/etc/named.conf

# cups
${RM}					/.setup/cups/mime.*
${LN} /usr/share/cups/mime/mime.*	/.setup/cups
${RM}					/etc/cups
${LN} /.setup/cups			/etc/cups

# dhcpd
${RM}					/etc/dhcpd.conf
${LN} /.setup/dhcpd/dhcpd.conf		/etc/dhcpd.conf

# dovecot
${RM}					/etc/dovecot
${LN} /.setup/dovecot			/etc/dovecot

# etc
declare FILE=
for FILE in \
	crypttab	\
	exports		\
	fstab		\
	host.conf	\
	hostname	\
	hosts		\
	issue		\
	locale.gen	\
	modules		\
	motd		\
	networks	\
	resolv.conf	\
	sysctl.conf
do
	${RM}				/etc/${FILE}
	${LN} /.setup/etc/${FILE}	/etc/${FILE}
done

# gentoo
${RM}					/etc/make.conf
${LN} /.setup/gentoo/make.conf		/etc/make.conf
${RM}					/etc/portage/package.keywords
${LN} /.setup/gentoo/package.keywords	/etc/portage/package.keywords
${RM}					/etc/portage/package.mask
${LN} /.setup/gentoo/package.mask	/etc/portage/package.mask
${RM}					/etc/portage/package.unmask
${LN} /.setup/gentoo/package.unmask	/etc/portage/package.unmask
${RM}					/etc/portage/package.use
${LN} /.setup/gentoo/package.use	/etc/portage/package.use

# grub
${RM}					/boot/grub/grub.cfg
${LN} /.setup/grub/grub.cfg		/boot/grub/grub.cfg

# linux

# minicom
${RM}					/etc/minicom
${LN} /.setup/minicom			/etc/minicom
${RM}					/etc/minirc.dfl
${LN} /.setup/minicom/minirc.dfl	/etc/minirc.dfl

# ntp
${RM}					/etc/ntp-servers.conf
${LN} /.setup/ntp/ntp-servers.conf	/etc/ntp-servers.conf
${RM}					/etc/ntp.conf
${LN} /.setup/ntp/ntp.conf		/etc/ntp.conf

# openvpn
${RM}					/etc/openvpn
${LN} /.setup/openvpn			/etc/openvpn

# proftpd
${RM}					/etc/proftpd.conf
${LN} /.setup/proftpd/proftpd.conf	/etc/proftpd.conf

# samba
chmod -v 700				/.setup/samba/private
chmod -v 400				/.setup/samba/private/*.tdb
${RM}					/etc/samba
${LN} /.setup/samba			/etc/samba

# ssh
chmod -v 400				/.setup/ssh/ssh_host_*
${RM}					/etc/ssh
${LN} /.setup/ssh			/etc/ssh

# xorg
${RM}					/etc/X11/Xmodmap
${LN} /.setup/xorg/Xmodmap		/etc/X11/Xmodmap
${RM}					/etc/X11/xorg.conf
${LN} /.setup/xorg/xorg.conf		/etc/X11/xorg.conf

########################################

${MKDIR}				/.runit
setconf ${SETCONF_DIR}/runit		/.runit

(cd /.runit;				./_build.sh)

exit 0
################################################################################
# end of file
################################################################################
